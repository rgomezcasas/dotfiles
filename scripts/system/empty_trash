#!/usr/bin/env bash

set -euo pipefail

source "$DOTLY_PATH/scripts/core/_main.sh"

##? Empty the trash and remove cache files
#?? 1.0.0
##?
##? Usage:
##?   empty_trash
docs::parse "$@"

free_space_in_home() {
	df -h ~ | tail -n1 | awk '{print $4}'
}

free_space_before_empty=$(free_space_in_home)

rm -rf ~/Library/Caches/* 2>/dev/null || true
echo 'ðŸ“¦ All caches cleared'

sudo rm -rfv /private/var/log/asl/*.asl
sudo rm -rfv /var/log/asl/*.asl
echo 'ðŸ“œ  Mac logs empty'

sqlite3 ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV* 'delete from LSQuarantineEvent'
echo 'â¬  Mac downloads history empty'

rm -rf "$HOME/Movies/"*.fcpbundle"/"*"/Render Files/High Quality Media"
echo 'ðŸŽ¬  Final Cut rendered media cleared'

brew cleanup
brew cleanup --prune-prefix
echo 'ðŸº  Brew cache cleared'

rm -rf "$HOME/Library/Application Support/Slack/Cache"
rm -rf "$HOME/Library/Application Support/Slack/Service Worker/CacheStorage"
echo 'ðŸ’¬  Slack cache cleared'

rm -rf "$HOME/Library/Application Support/Cursor/CachedData/"
echo 'ðŸ’¬  Cursor cache cleared'

rm -rf "$HOME/Library/Application Support/Notion/Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Code Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/GPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/DawnCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/DawnGraphiteCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/DawnWebGPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/Code Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/Service Worker/CacheStorage" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/Service Worker/ScriptCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/GPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/DawnCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/DawnGraphiteCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/DawnWebGPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/notion/WebStorage" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/meeting-notification/Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/meeting-notification/Code Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/meeting-notification/Service Worker/CacheStorage" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/meeting-notification/GPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Notion/Partitions/meeting-notification/WebStorage" 2>/dev/null || true
rm -rf "$HOME/Library/HTTPStorages/notion.id" 2>/dev/null || true
echo 'ðŸ“  Notion cache cleared'

rm -rf "$HOME/.npm/_cacache/"
rm -rf "$HOME/.npm/_npx/"
rm -rf "$HOME/.yarn/berry/cache"
echo 'ðŸ’ª  NPM cache cleared'

find "$HOME/Code" -type d -path "*/.next/cache" -exec rm -rf {} \; -prune
echo 'ðŸ’ª  Next.js cache cleared'

rm -rf "$HOME/Library/Application Support/com.turborepo.turborepo/logs"
find "$HOME/Code" -type d -path "*/.turbo/cache" -exec rm -rf {} \; -prune
echo 'ðŸ’¨ Turborepo logs & cache cleared'

find "$HOME/Code" -type d -path "*/node_modules" -exec rm -rf {} \; -prune
echo 'ðŸ’ª  node_modules cleared'

rm -rf ~/.gradle/wrapper/dists/
rm -rf ~/.gradle/caches/
echo 'ðŸ˜  Gradle cache cleared'

rm -rf ~/.composer/cache/
echo 'ðŸ‘¨â€ðŸŽ¤  Composer cache cleared'

rm -rf ~/Library/Caches/com.docker.docker/ 2>/dev/null || true
rm -rf ~/Library/Containers/com.docker.docker/ 2>/dev/null || true
rm -rf ~/Library/Group\ Containers/group.com.docker/ 2>/dev/null || true
rm -rf ~/.docker/models/ 2>/dev/null || true
rm -rf ~/.docker/model/ 2>/dev/null || true
echo 'ðŸ³  Docker data, cache & models cleared'

rm -rf ~/Library/Group\ Containers/HUAQ24HBR6.dev.orbstack/data/ 2>/dev/null || true
echo 'ðŸŒ€  OrbStack data cleared'

rm -rf ~/.ollama/models/ 2>/dev/null || true
echo 'ðŸ¤–  Ollama models removed'

nix-collect-garbage -d
echo 'â„ï¸  Nix store cleaned'

rm -rf "$HOME/Library/Application Support/Google/Chrome/"*"/Service Worker/CacheStorage" || true
rm -rf "$HOME/Library/Application Support/Google/Chrome/"*"/Application Cache/Cache" || true
echo 'ðŸŸ¡  Chrome cache cleared'

rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/Application Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/Code Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/GPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/Service Worker" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/Cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/"*"/Temp" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Google/Chrome Canary/OptGuideOnDeviceModel" 2>/dev/null || true
rm -rf "$HOME/Library/Caches/Google/Chrome Canary" 2>/dev/null || true
echo 'ðŸŸ¡  Chrome Canary cache cleared'

rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/Service Worker/CacheStorage" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/GPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/DawnCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/DawnGraphiteCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/DawnWebGPUCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/"*"/AutofillAiModelCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/GrShaderCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/GraphiteDawnCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/component_crx_cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/User Data/extensions_crx_cache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/ArchiveItemsFaviconCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/ArchiveSnapshotCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/BoostsImageCache" 2>/dev/null || true
rm -rf "$HOME/Library/Application Support/Arc/SidebarItemsFaviconCache" 2>/dev/null || true
rm -rf "$HOME/Library/Caches/Arc/User Data" 2>/dev/null || true
echo 'ðŸŒˆ  Arc cache cleared'

rm -rf /Users/rafa.gomez/Library/Application\ Support/stremio-server/stremio-cache/
echo 'ðŸ“º  Stremio cache cleared'

osascript -e 'tell app "Finder" to empty' 2>/dev/null || true
echo 'ðŸ—‘   All trashes empty'

free_space_after_empty=$(free_space_in_home)

echo "Done! Free space before: $free_space_before_empty, free space now: $free_space_after_empty"
